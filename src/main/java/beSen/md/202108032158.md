笔记：记录工作笔记
日期：2021年08月03日
天气：晴天


关于流程的需求
比如有这样二个节点，110040，110050
每个节点对应有多个父项编码 一个父项编码对应一个local_flow_id
一个local_flow_id对应多个node表(父项编码的在当前节点的进度信息)

数据模拟 节点是串行的，但是可以同时开启进行中

110040 节点

父项编码   local_flow_id        node_code   status      评审结论
1           100                 110040      进行中        未评审
            local_flow_id      node_code     status    
           100                 110050        进行中
           
  2                                                       评审结论
                               110040         完成              同意   下一个节点是进行，如果驳回，下一个节点未开始
 
  3                                                      评审结论
                               110040        未开始           驳回        
           
110050 节点

父项编码   local_flow_id        node_code   status
1           100                 110040      进行中
           local_flow_id      node_code     status
          100                 110050        进行中
          

110040 节点 对父项编码1进行批量同意，同意的不修改，未评审的status修改为完成，评审结论修改为同意
如果同意的进行批量驳回  评审结论 驳回  驳回原因必填  状态变成未开始  ，前一个节点 状态变进行中，后一个节点状态 unStart
如果未评审的进行批量驳回  评审结论 驳回  驳回原因必填  状态变成 未开始 ，前一个节点对应 进行中（local_flow_id 找出）

驳回的看不到了，在前一个节点是进行中


前端传一个list ,包含node表的主键 
当是批量同意时，Java先过滤同意的数据
未评审的status修改为完成，评审结论修改为同意

当批量驳回时，不管时同意还是未评审的
当前节点 评审结论 驳回  驳回原因必填  状态变成未开始 
如果是未评审的
根据 local_flow_id  和  当前node_code  - 10 更新 node_status start
如果是同意的 
根据local_flow_id  和  当前node_code  + 10 更新 node_status upstart


注：最后一个父项编码提交的时候要记录流程日志和更新主节点状态
因为不知道是否是最后一次提交，所以提交的时候都要调用我的查询  （总数，完成数量，前一个节点是否完成）查询返回的信息

最后一个节点数据的生成是根据前一个节点来的，当前一个节点有父项编码提交的时候，那么在当前节点是完成，下一个节点是进行中
而有些父项编码是不需要生成的，根据某些条件判断，同时会有默认值
提供一个接口IService 有下面四个方法
公共方法 A（查询是否最后一个提交）  B（流程记录） C(批量驳回和同意)  D(下一个节点数据初始化)
写一个实现类 Service

写一个暴露服务的service  提供URL 
组合功能 （批量同意和驳回 +  下一个节点数据初始化 + 查询是否是最后一个提交 +  流程记录 + 行云），这个方法同意或者驳回的时候调用，提供给前台
行云逻辑：有一个父项编码提交，当前节点关闭，开启下一个节点进行中
如果驳回呢？


批量或者不是批量都是传一个list,list需要传 node_code,local_flow_id,node_id,驳回原因，父项parent_info_id
如果该父项的id满足条件（是否在研单板）则状态更新unStart(因为查询只会查出进行中和完成的数据/驳回)
如果满足(在制定认证计划选择同意) 更新默认值


